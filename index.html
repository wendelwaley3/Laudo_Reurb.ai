<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLaudo.AI - Análise Geográfica</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1>GeoLaudo.AI - Análise de Desconformidades</h1>
    </div>

    <div class="dashboard-container">
        <div class="sidebar">
            <div class="tab-menu">
                <button class="tab-button active" onclick="openTab(event, 'UploadTab')">Upload/Filtro</button>
                <button class="tab-button" onclick="openTab(event, 'LayersTab')">Visualização</button>
                <button class="tab-button" onclick="openTab(event, 'ReportTab')">Relatório</button>
            </div>

            <div id="UploadTab" class="tab-content">
                <h3>Carregamento de Dados</h3>
                <div class="form-group">
                    <label for="sigas-select">Sistema de Referência (Opcional):</label>
                    <select id="sigas-select">
                        <option value="wgs84">WGS84 (Padrão)</option>
                        <option value="23s">UTM Zona 23S</option>
                        <option value="24s">UTM Zona 24S</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="geojson-file">Arquivo GeoJSON (Lotes/Poligonais):</label>
                    <input type="file" id="geojson-file" accept=".geojson" onchange="handleFileUpload()">
                </div>
                <div id="upload-status" class="status-message success hidden"></div>

                <hr>

                <h3>Filtro Geográfico (Núcleo)</h3>
                 <div class="form-group">
                    <label for="nucleo-filter">Selecionar Núcleo:</label>
                    <select id="nucleo-filter" onchange="filterByNucleo()">
                        <option value="all">Todos os Lotes</option>
                        </select>
                </div>
            </div>

            <div id="LayersTab" class="tab-content hidden">
                <h3>Camadas Carregadas</h3>
                <ul id="main-layer-list">
                    </ul>
                <h3 style="margin-top: 15px;">Filtro por Risco (Grau)</h3>
                <ul id="risk-layer-filter" class="risk-legend">
                    </ul>
            </div>

            <div id="ReportTab" class="tab-content hidden">
                <h3>Geração de Relatório Profissional</h3>
                <p>O relatório será gerado com gráficos, destaque de áreas de intervenção e formatado para impressão.</p>
                <button id="generate-report-btn" class="action-button primary" onclick="generateReport()">Gerar Relatório Completo (PDF)</button>

                <hr>

                <h4>Destaques de Intervenção:</h4>
                <div id="highlight-cards">
                    <div class="highlight-card max-cost">
                        <h5>Maior Custo de Intervenção:</h5>
                        <p id="max-cost-value">---</p>
                        <p id="max-cost-info">---</p>
                    </div>
                    <div class="highlight-card min-cost">
                        <h5>Menor Custo de Intervenção:</h5>
                        <p id="min-cost-value">---</p>
                        <p id="min-cost-info">---</p>
                    </div>
                </div>
            </div>
            
        </div>

        <div class="content">
            <div class="summary-cards">
                <div class="card">
                    <div class="card-value" id="total-lotes">0</div>
                    <div class="card-title">Lotes/Feições Carregadas</div>
                </div>
                <div class="card">
                    <div class="card-value" id="total-desconformidades">0</div>
                    <div class="card-title">Total de Desconformidades</div>
                </div>
                <div class="card">
                    <div class="card-value" id="total-app-lotes">0</div>
                    <div class="card-title">Lotes em APP</div>
                </div>
                <div class="card">
                    <div class="card-value" id="custo-estimado">R$ 0,00</div>
                    <div class="card-title">Custo Total de Intervenção</div>
                </div>
            </div>

            <div id="map"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-2Pmvv0kuTBOk3e5fFzI6vQ9yGgB5z0T7E5X0B30X4B0="
        crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
