<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLaudo.AI - Análise REURB</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <link rel="stylesheet" href="css/style.css"> 
</head>
<body>
    <header>
        <div class="logo">GeoLaudo.AI</div>
        <nav>
            <a href="#" data-section="dashboard" class="active">Dashboard</a>
            <a href="#" data-section="upload">Upload de Dados</a>
            <a href="#" data-section="informacoes-gerais">Informações Gerais</a>
            <a href="#" data-section="dados-lotes">Dados Lotes</a> 
            <a href="#" data-section="relatorios">Relatórios</a>
            <a href="#" data-section="instrucoes">Instruções</a>
            <button id="exportReportBtn" title="Exportar Relatório em TXT (Após Geração)" style="display: none;">Exportar Relatório</button>
        </nav>
    </header>

    <main>
        <section id="dashboard" class="content-section active">
            <h2>Dashboard Geoespacial</h2>
            
            <div class="dashboard-grid">
                <div class="sidebar-controls">
                    <div class="summary-cards">
                        <div class="card">
                            <span class="card-value" id="totalLotesCarregados">0</span>
                            <span class="card-title">Lotes Carregados</span>
                        </div>
                        <div class="card">
                            <span class="card-value" id="totalLotesComRisco">0</span>
                            <span class="card-title">Lotes em Risco</span>
                        </div>
                        <div class="card">
                            <span class="card-value" id="totalLotesEmAPP">0</span>
                            <span class="card-title">Lotes em APP</span>
                        </div>
                        <div class="card">
                            <span class="card-value" id="custoEstimadoTotal">R$ 0,00</span>
                            <span class="card-title">Custo Intervenção Total</span>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <h3>Filtro Geográfico</h3>
                        <div class="form-group">
                            <label for="nucleo-filter">Filtrar por Núcleo:</label>
                            <select id="nucleo-filter" onchange="applyFilters()">
                                <option value="all">Todos os Lotes/Núcleos</option>
                            </select>
                        </div>
                        
                        <h3>Camadas e Filtro de Risco (Visualização Espacial)</h3>
                        <div id="layer-controls-container">
                             <ul id="main-layer-list" class="layer-list">
                                </ul>

                            <p style="margin-top: 10px; font-size: 0.9em; font-weight: 600;">Filtro por Grau de Risco (Cores):</p>
                            <ul id="risk-layer-filter" class="risk-legend">
                                </ul>
                        </div>
                    </div>
                </div>

                <div id="mapid" class="map-container"></div>

            </div>
        </section>

        <section id="upload" class="content-section">
            <h2>Upload de Dados Geoespaciais</h2>
            <div class="upload-grid">
                <div class="upload-group">
                    <h3>1. Arquivo Principal (Lotes/Poligonais)</h3>
                    <div class="form-group">
                        <label for="geojson-lotes-file">GeoJSON Lotes/Feições (Com NUCLEO, GRAU_RISCO e CUSTO):</label>
                        <input type="file" id="geojson-lotes-file" accept=".geojson" onchange="handleFileUpload('lotes')">
                    </div>
                    <div class="form-group">
                        <label for="siga-lotes-select">Sistema de Referência (Opcional):</label>
                        <select id="siga-lotes-select" class="siga-select">
                            <option value="wgs84">WGS84 (Padrão)</option>
                            <option value="23s">UTM Zona 23S</option>
                            <option value="24s">UTM Zona 24S</option>
                        </select>
                    </div>
                    <div id="status-lotes" class="upload-status"></div>
                </div>
